<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Document</title>
    </head>
    <body>
        <canvas id="myCanvas"></canvas>
        <script>
            class PinShapeDrawer {
                constructor(canvas) {
                    this.canvas = canvas
                    this.ctx = canvas.getContext("2d")

                    // 常量定义
                    this.RADIUS = 10 // pinsymbol_size
                    this.DIAMETER = this.RADIUS * 2
                    this.NC_RADIUS = 15 // target_pin_radius (用于 no_connect)
                }

                /**
                 * 计算引脚起点和方向向量
                 */
                calculateStem(position, orientation, length) {
                    const p0 = { x: position.x, y: position.y }
                    const dir = { x: 0, y: 0 }

                    switch (orientation) {
                        case "up":
                            p0.y += length
                            dir.y = -1
                            break
                        case "down":
                            p0.y -= length
                            dir.y = 1
                            break
                        case "left":
                            p0.x += length
                            dir.x = -1
                            break
                        case "right":
                            p0.x -= length
                            dir.x = 1
                            break
                    }

                    return { p0, dir }
                }

                /**
                 * 绘制引脚形状
                 */
                drawPinShape(
                    shape,
                    electricalType,
                    position,
                    orientation,
                    length
                ) {
                    const { p0, dir } = this.calculateStem(
                        position,
                        orientation,
                        length
                    )

                    this.ctx.beginPath()
                    this.ctx.strokeStyle = "#000"
                    this.ctx.lineWidth = 1

                    // 首先绘制主干线
                    this.ctx.moveTo(p0.x, p0.y)
                    this.ctx.lineTo(position.x, position.y)
                    this.ctx.stroke()

                    // 特殊处理 no_connect 类型
                    if (electricalType === "no_connect") {
                        this.drawNoConnect(position)
                        return
                    }

                    // 根据形状绘制装饰
                    switch (shape) {
                        case "line":
                            // 基本线型，无需额外绘制
                            break

                        case "inverted":
                            this.drawInverted(p0, dir)
                            break

                        case "clock":
                            this.drawClock(p0, dir)
                            break

                        case "inverted_clock":
                            this.drawInverted(p0, dir)
                            this.drawClock(p0, dir)
                            break

                        case "input_low":
                            this.drawInputLow(p0, dir)
                            break

                        case "clock_low":
                        case "edge_clock_high":
                            this.drawClock(p0, dir)
                            this.drawInputLow(p0, dir)
                            break

                        case "output_low":
                            this.drawOutputLow(p0, dir)
                            break

                        case "non_logic":
                            this.drawNonLogic(p0, dir)
                            break
                    }
                }

                /**
                 * 绘制不连接标记 (X)
                 */
                drawNoConnect(pos) {
                    const r = this.NC_RADIUS
                    this.ctx.beginPath()
                    this.ctx.moveTo(pos.x - r, pos.y - r)
                    this.ctx.lineTo(pos.x + r, pos.y + r)
                    this.ctx.moveTo(pos.x + r, pos.y - r)
                    this.ctx.lineTo(pos.x - r, pos.y + r)
                    this.ctx.stroke()
                }

                /**
                 * 绘制反相圆圈
                 */
                drawInverted(p0, dir) {
                    const centerX = p0.x + dir.x * this.RADIUS
                    const centerY = p0.y + dir.y * this.RADIUS

                    this.ctx.beginPath()
                    this.ctx.arc(centerX, centerY, this.RADIUS, 0, Math.PI * 2)
                    this.ctx.stroke()
                }

                /**
                 * 绘制时钟符号
                 */
                drawClock(p0, dir) {
                    const r = this.RADIUS

                    this.ctx.beginPath()
                    if (!dir.y) {
                        // 水平方向
                        this.ctx.moveTo(p0.x, p0.y + r)
                        this.ctx.lineTo(p0.x - dir.x * r, p0.y)
                        this.ctx.lineTo(p0.x, p0.y - r)
                    } else {
                        // 垂直方向
                        this.ctx.moveTo(p0.x + r, p0.y)
                        this.ctx.lineTo(p0.x, p0.y - dir.y * r)
                        this.ctx.lineTo(p0.x - r, p0.y)
                    }
                    this.ctx.stroke()
                }

                /**
                 * 绘制输入低电平符号（三角形）
                 */
                drawInputLow(p0, dir) {
                    const d = this.DIAMETER

                    this.ctx.beginPath()
                    if (!dir.y) {
                        // 水平方向
                        this.ctx.moveTo(p0.x + dir.x * d, p0.y)
                        this.ctx.lineTo(p0.x + dir.x * d, p0.y - d)
                        this.ctx.lineTo(p0.x, p0.y)
                    } else {
                        // 垂直方向
                        this.ctx.moveTo(p0.x, p0.y + dir.y * d)
                        this.ctx.lineTo(p0.x - d, p0.y + dir.y * d)
                        this.ctx.lineTo(p0.x, p0.y)
                    }
                    this.ctx.closePath()
                    this.ctx.stroke()
                }

                /**
                 * 绘制输出低电平符号
                 */
                drawOutputLow(p0, dir) {
                    const d = this.DIAMETER

                    this.ctx.beginPath()
                    if (!dir.y) {
                        // 水平方向
                        this.ctx.moveTo(p0.x, p0.y - d)
                        this.ctx.lineTo(p0.x + dir.x * d, p0.y)
                    } else {
                        // 垂直方向
                        this.ctx.moveTo(p0.x - d, p0.y)
                        this.ctx.lineTo(p0.x, p0.y + dir.y * d)
                    }
                    this.ctx.stroke()
                }

                /**
                 * 绘制非逻辑符号（X形）
                 */
                drawNonLogic(p0, dir) {
                    const r = this.RADIUS

                    this.ctx.beginPath()
                    // 第一条对角线
                    this.ctx.moveTo(
                        p0.x - (dir.x + dir.y) * r,
                        p0.y - (dir.y - dir.x) * r
                    )
                    this.ctx.lineTo(
                        p0.x + (dir.x + dir.y) * r,
                        p0.y + (dir.y - dir.x) * r
                    )

                    // 第二条对角线
                    this.ctx.moveTo(
                        p0.x - (dir.x - dir.y) * r,
                        p0.y - (dir.y + dir.x) * r
                    )
                    this.ctx.lineTo(
                        p0.x + (dir.x - dir.y) * r,
                        p0.y + (dir.y + dir.x) * r
                    )
                    this.ctx.stroke()
                }
            }
            const canvas = document.getElementById("myCanvas")
            const drawer = new PinShapeDrawer(canvas)

            // 示例：绘制各种形状的引脚
            const shapes = [
                "line",
                "inverted",
                "clock",
                "inverted_clock",
                "input_low",
                "clock_low",
                "output_low",
                "non_logic",
            ]

            // 在画布上垂直排列显示所有形状
            shapes.forEach((shape, index) => {
                drawer.drawPinShape(
                    shape,
                    "normal", // electricalType
                    { x: 100, y: 50 + index * 50 }, // position
                    "right", // orientation
                    40 // length
                )
            })

            // 特别展示 no_connect 类型
            drawer.drawPinShape(
                "line",
                "no_connect",
                { x: 100, y: 50 + shapes.length * 50 },
                "right",
                40
            )
        </script>
    </body>
</html>
